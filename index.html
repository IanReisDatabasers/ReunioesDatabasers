<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Atas de Reunião - Databasers</title>
  <style>
    body {
      color: #e0e7f8;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    .video-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      object-fit: cover;
      opacity: 0.3;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
      z-index: 1;
    }

    header img {
      max-width: 180px;
      margin-bottom: 10px;
    }

    h1 {
      color: #234a9e; /* azul mais escuro */
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: bold;
      text-shadow: 1px 1px 3px #001d3d;
    }

    label {
      font-size: 1.2em;
      margin-bottom: 20px;
      display: block;
      color: #234a9e; /* azul mais escuro */
      font-weight: bold;
    }

    select {
      padding: 8px;
      border-radius: 5px;
      border: none;
      background-color: #1a2e5a;
      color: #e0e7f8;
      width: 250px;
      cursor: pointer;
      font-size: 1.1em;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background-color: rgba(26, 46, 90, 0.8);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 15px #001d3d;
    }

    th, td {
      padding: 12px 15px;
      border-bottom: 1px solid #073763;
    }

    th {
      background-color: #234a9e;
      font-weight: bold;
      text-align: left;
      color: #d6e4ff;
    }

    tr:hover {
      background-color: #2c558f;
    }

    .no-data {
      margin-top: 20px;
      font-size: 1.1em;
      color: #c2d3f7;
    }

    #atasContainer {
      position: relative;
      z-index: 1;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
<video autoplay muted loop id="bgVideo" class="video-background">
  <source src="src/background_heroArea_home.mp4" type="video/mp4">
  Seu navegador não suporta vídeos HTML5.
</video>

<header>
  <img src="src/logotipoDatabasersWhite.svg" alt="Databasers Logo" />
  <h1>Atas de Reunião - Painel: <span id="tituloPainel"></span></h1>
</header>

<label for="painelSelect">Selecione o Painel:</label>
<select id="painelSelect">
  <option value="" disabled selected>Carregando...</option>
</select>

<div id="atasContainer">
  <p class="no-data">Carregando atas...</p>
</div>

<script>
  const painelSelect = document.getElementById("painelSelect");
  const atasContainer = document.getElementById("atasContainer");
  const tituloPainel = document.getElementById("tituloPainel");

  let atas = []; // Variável global para armazenar as atas carregadas

  function formatarData(dateStr) {
    const dt = new Date(dateStr);
    return dt.toLocaleDateString('pt-BR') + ' ' + dt.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
  }

  function renderizarAtas(painel) {
    tituloPainel.textContent = painel;
    const atasFiltradas = atas
      .filter(ata => ata.painel === painel)
      .sort((a,b) => new Date(b.data) - new Date(a.data));

    atasContainer.innerHTML = "";

    if (atasFiltradas.length === 0) {
      atasContainer.innerHTML = '<p class="no-data">Nenhuma ata encontrada para este painel.</p>';
      return;
    }

    atasFiltradas.forEach(ata => {
      const divAta = document.createElement("div");
      divAta.style.marginBottom = "40px";

      divAta.innerHTML = `
        <table>
          <thead>
            <tr><th colspan="2">Detalhes da Reunião</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Data e Hora:</strong></td><td>${formatarData(ata.data)}</td></tr>
            <tr><td><strong>Meio:</strong></td><td>${ata.meio}</td></tr>
            <tr><td><strong>Participantes:</strong></td><td>${ata.participantes.join(", ")}</td></tr>
          </tbody>
        </table>

        <table>
          <thead>
            <tr><th>Tópico</th><th>Responsável</th><th>Pontos Tratados</th></tr>
          </thead>
          <tbody>
            ${ata.topicos.map(t => 
              `<tr>
                <td>${t.titulo}</td>
                <td>${t.responsavel}</td>
                <td><ul>${t.pontos.map(p => `<li>${p}</li>`).join("")}</ul></td>
              </tr>`
            ).join("")}
          </tbody>
        </table>

        <table>
          <thead>
            <tr><th>Ação</th><th>Objetivo</th><th>Responsável</th><th>Estimativa de Tempo</th><th>Prazo de Conclusão</th><th>Retorno para</th></tr>
          </thead>
          <tbody>
            ${ata.acoes.length > 0 ? ata.acoes.map(a => 
              `<tr>
                <td>${a.acao}</td>
                <td style="white-space: pre-line;">${a.objetivo}</td>
                <td>${a.responsavel}</td>
                <td>${a.tempo}</td>
                <td>${formatarData(a.prazo)}</td>
                <td>${a.retorno}</td>
              </tr>`
            ).join("") : '<tr><td colspan="6" style="text-align:center;">Nenhuma ação registrada.</td></tr>'}
          </tbody>
        </table>

        <p><strong>Observações:</strong> ${ata.observacoes || "Nenhuma observação."}</p>
      `;

      atasContainer.appendChild(divAta);
    });
  }

  // Função para carregar os dados do arquivo JSON
  async function carregarAtas() {
    try {
      const response = await fetch('atas.json');
      if (!response.ok) {
        throw new Error('Falha ao carregar o arquivo de atas');
      }
      atas = await response.json();
      
      // Atualizar o seletor de painéis
      const paineisUnicos = [...new Set(atas.map(ata => ata.painel))].sort();
      
      painelSelect.innerHTML = '';
      if (paineisUnicos.length > 0) {
        paineisUnicos.forEach(painel => {
          const option = document.createElement("option");
          option.value = painel;
          option.textContent = painel;
          painelSelect.appendChild(option);
        });
        
        // Selecionar o primeiro painel por padrão
        painelSelect.value = paineisUnicos[0];
        renderizarAtas(paineisUnicos[0]);
      } else {
        painelSelect.innerHTML = '<option value="" disabled selected>Nenhum painel disponível</option>';
        atasContainer.innerHTML = '<p class="no-data">Nenhuma ata disponível.</p>';
      }
    } catch (error) {
      console.error('Erro ao carregar atas:', error);
      atasContainer.innerHTML = `<p class="no-data">Erro ao carregar as atas: ${error.message}</p>`;
      painelSelect.innerHTML = '<option value="" disabled selected>Erro ao carregar</option>';
    }
  }

  // Adicionar listener para mudanças no seletor
  painelSelect.addEventListener("change", (e) => {
    renderizarAtas(e.target.value);
  });

  // Carregar os dados quando a página for carregada
  document.addEventListener('DOMContentLoaded', carregarAtas);
</script>

</body>
</html>
